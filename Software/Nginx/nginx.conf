# Software/Nginx/nginx.conf

# Define an "upstream" block which points to our Next.js application container.
# The name 'frontend_app' is arbitrary.
# The hostname 'frontend' MUST match the service name in docker-compose.yaml.
# We connect to port 3000 because that's what the Next.js container exposes internally.
upstream frontend_app {
    server frontend:3000;
}

server {
    # Nginx will listen on port 80, the standard HTTP port.
    listen 80;
    listen [::]:80;

    # This server block will handle all requests to your server's IP address.
    server_name _;

    location / {
        # Pass all requests to the "upstream" block we defined above.
        proxy_pass http://frontend_app;

        # Set necessary headers to pass along to the Next.js app so it knows
        # about the original request details (e.g., the user's IP address).
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}